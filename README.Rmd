---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# tidydt v`r as.character(packageVersion("tidydt"))`   <img src="man/figures/logo.png" align="right" width="15%" height="15%" />

<!-- badges: start -->
[![Lifecycle: maturing](https://img.shields.io/badge/lifecycle-maturing-blue.svg)](https://www.tidyverse.org/lifecycle/#maturing)
<!-- badges: end -->

The goal of `tidydt` is to be a tidy interface to `data.table`.

`tidydt` is `rlang` compatible.

## Installation

You can install the development version from [GitHub](https://github.com/) with:

``` r
# install.packages("devtools")
devtools::install_github("markfairbanks/tidydt")
```

## tidydt functions

### tidydt helpers
* `as_dt()`: Safely operate on data.tables/convert data.frames to data.tables
* `%notin%`
* `dt()`: Pipeable `data.table` call. [See example here](https://github.com/mtfairbanks/gdt#dt-helper)

### dplyr

##### Core verbs

* `dt_arrange()`
* `dt_filter()`
* `dt_mutate()`, `dt_mutate_if()`, `dt_mutate_at()`, & `dt_mutate_all()`
* `dt_select()`, `dt_select_if()`
* `dt_summarize()`: Group by specifications called inside. See `?dt_summarize`

##### Other dplyr functions

* `dt_bind_rows()` & `dt_bind_cols()`
* `dt_count()`
* `dt_distinct()`
* `dt_pull()`
* `dt_rename()`, `dt_rename_if()`, `dt_rename_at()`, & `dt_rename_all()`
* `dt_slice()`
* `dt_top_n()`
* `dt_left_join()`, `dt_inner_join()`, `dt_right_join()`, & `dt_full_join()`

### tidyr

* `dt_pivot_longer()` & `dt_pivot_wider()`
* `dt_drop_na()`
* `dt_replace_na()`
* `dt_fill()`
& `dt_group_nest()` & `dt_unnest()`

### purrr
* `dt_map()`, `dt_map2()`, `dt_map_*()` variants, & `dt_map2_*()` variants


## General syntax

The code chunk below shows the `tidydt` syntax:

```{r message = FALSE}
library(tidydt) # Loads data.table and %>%

example_dt <- data.table(x = c(1,2,3), y = c(4,5,6), z = c("a", "a", "b"))

example_dt %>%
  as_dt() %>%
  dt_select(x, y, z) %>%
  dt_filter(x < 4, y > 1) %>%
  dt_arrange(x, y) %>%
  dt_mutate(double_x = x * 2,
            double_y = y * 2) %>%
  dt_mutate_if(is.character, as.factor) %>%
  dt_rename(new_x = x,
            new_y = y)
```

Group by calls are done from inside `dt_summarize()` or any function that has by group functionality.

A single bare column can be passed with `by = z`. Multiple columns can be passed with `by = list(y, z)`.

```{r}
example_dt <- data.table(x = c(1,2,3), y = c(4,5,6), z = c("a", "a", "b"))

example_dt %>%
  dt_summarize(avg_x = mean(x), by = z)
```


#### `rlang` compatibility

`rlang` quoting/unquoting can be used to write custom functions with `tidydt` functions:

```{r}
example_dt <- data.table(x = c(1,2,3), y = c(4,5,6), z = c("a", "a", "b"))

add_one <- function(.data, new_name, add_col) {
  new_name <- enexpr(new_name)
  add_col <- enexpr(add_col)
  
  .data %>%
    dt_mutate(!!new_name := !!add_col + 1)
}

example_dt %>%
  add_one(x_plus_one, x)
```

Note that quosures are not compatible with `data.table`, so `enexpr()` must be used instead of `enquo()`.

#### `dt()` helper

The `dt()` function makes `data.table` syntax pipeable:

```{r}
example_dt <- data.table(x = c(1,2,3), y = c(4,5,6), z = c("a", "a", "b"))

example_dt %>%
  as_dt() %>%
  dt(, list(x, y, z)) %>%
  dt(x < 4 & y > 1) %>%
  dt(order(x, y)) %>%
  dt(, ':='(double_x = x * 2,
            double_y = y * 2)) %>%
  dt(, list(avg_x = mean(x)), by = z)
```
